{% extends 'ontime_app/base.html' %}
{% load static %}

{% block title %}Historial de Asistencia - OnTime{% endblock %}

{% block content %}
<!-- Botón de flecha para retroceder -->
<div class="mt-6 text-center">
  <a href="javascript:history.back()" class="flex items-center text-gray-600 hover:text-green-800 transition-all duration-300">
      <i class="fas fa-arrow-left mr-2"></i>
      Regresar
  </a>
</div>
  <div class="bg-gray-100 shadow-xl rounded-3xl p-6 md:p-10 w-full max-w-4xl mx-auto mt-18 animate__animated animate__fadeIn animate__faster">
    
    <h2 class="text-4xl font-extrabold text-gray-800 text-center mb-6 animate-pulse">Consulta tu Historial de Asistencia</h2>
    <p class="text-center text-gray-600 mb-8">Aquí podrás ver el registro completo de tus asistencias.</p>

    <!-- Filtros de Búsqueda -->
<div class="flex mb-6 gap-6">
    <!-- Fecha de inicio -->
    <div class="w-full md:w-1/3 text-gray-600">
      <label for="fecha_inicio" class="block text-sm font-medium text-gray-700">Fecha de inicio</label>
      <input type="date" id="fecha_inicio" class="w-full p-2 mt-1 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>
  
    <!-- Fecha de fin -->
    <div class="w-full md:w-1/3 text-gray-600">
      <label for="fecha_fin" class="block text-sm font-medium text-gray-700">Fecha de fin</label>
      <input type="date" id="fecha_fin" class="w-full p-2 mt-1 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500" />
    </div>
  
    <!-- Botón Filtrar -->
    <div class="w-full md:w-1/3 mt-5">
      <button class="bg-green-600 text-white py-4 px-6 w-full rounded-lg hover:bg-green-700 transition duration-300 shadow-md focus:ring-4 focus:ring-green-500 focus:outline-none" id="btn-filtrar">
        Filtrar
      </button>
    </div>
  </div>  

    <!-- Tabla de Historial de Asistencia -->
    <div class="overflow-x-auto bg-white shadow-md rounded-lg p-6 max-h-96 overflow-y-auto">
      <table class="min-w-full table-auto">
        <thead class="bg-gray-200">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-800">Fecha</th>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-800">Curso/Competencia</th>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-800">Estado</th>
            <th class="px-6 py-3 text-left text-sm font-medium text-gray-800">Acción</th>
          </tr>
        </thead>
        <tbody class="text-sm font-normal text-gray-600" id="tabla-historial">
          <!-- Aquí se insertarán las filas dinámicamente -->
        </tbody>
      </table>
    </div>

    <!-- Paginación y Botón Ver Más -->
    <div class="flex justify-center mt-8">
      <button class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition duration-300 shadow-md focus:ring-4 focus:ring-green-500 focus:outline-none" id="btn-ver-mas">
        Ver más
      </button>
    </div>

  </div>

  <!-- Script para la interacción -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Datos simulados de asistencia
      const datosAsistencia = [
        { id: 1, fecha: '2025-04-18', curso: 'Programación Web', estado: 'Asistido', detalles: 'Se completó el módulo de HTML, CSS y JavaScript. Sin problemas en el proceso de aprendizaje.' },
        { id: 2, fecha: '2025-04-17', curso: 'Bases de Datos', estado: 'Faltante', detalles: 'El aprendiz no asistió debido a un evento personal. No se presentó justificación.' },
        { id: 3, fecha: '2025-04-16', curso: 'Introducción a la Programación', estado: 'Asistido', detalles: 'Se cubrió la introducción a la programación en Python. El aprendiz participó activamente.' },
        { id: 4, fecha: '2025-04-15', curso: 'Algoritmos y Estructuras de Datos', estado: 'Faltante', detalles: 'El aprendiz no asistió debido a problemas familiares. Se espera recuperación en la próxima clase.' },
        { id: 5, fecha: '2025-04-14', curso: 'Redes y Comunicaciones', estado: 'Asistido', detalles: 'El aprendiz completó todos los ejercicios prácticos de redes y fue evaluado satisfactoriamente.' },
        { id: 6, fecha: '2025-04-13', curso: 'Diseño Web', estado: 'Asistido', detalles: 'Se trabajó en la creación de una página web responsive. El aprendiz mostró buena comprensión.' },
        { id: 7, fecha: '2025-04-12', curso: 'Redes de Computadoras', estado: 'Faltante', detalles: 'El aprendiz no asistió debido a problemas de transporte. Se ha acordado que lo recuperará más tarde.' },
        { id: 8, fecha: '2025-04-11', curso: 'Bases de Datos Avanzadas', estado: 'Asistido', detalles: 'Se abordaron conceptos avanzados de SQL y optimización de consultas. El aprendiz mostró un buen desempeño.' },
        { id: 9, fecha: '2025-04-10', curso: 'Programación Avanzada', estado: 'Faltante', detalles: 'El aprendiz no asistió y no presentó justificativa. Se espera su regreso en la siguiente clase.' },
        { id: 10, fecha: '2025-04-09', curso: 'Sistemas Operativos', estado: 'Asistido', detalles: 'Se cubrieron los fundamentos de sistemas operativos. El aprendiz completó las tareas y ejercicios asignados.' },
      ];

      const filasPorPagina = 3; // Mostrar 3 filas por página
      let paginaActual = 0;

      // Función para mostrar datos
      function mostrarHistorial() {
        const tabla = document.getElementById('tabla-historial');
        
        const inicio = paginaActual * filasPorPagina;
        const fin = inicio + filasPorPagina;
        const historialVisible = datosAsistencia.slice(inicio, fin);

        historialVisible.forEach(item => {
          const row = document.createElement('tr');
          row.classList.add('hover:bg-gray-50');
          const idDetalle = 'detalle-' + item.id;
          row.innerHTML = `
            <td class="px-6 py-4">${item.fecha}</td>
            <td class="px-6 py-4">${item.curso}</td>
            <td class="px-6 py-4 text-${item.estado === 'Asistido' ? 'green' : 'red'}-600">${item.estado}</td>
            <td class="px-6 py-4">
              <button id="btn-${idDetalle}" class="text-green-600 hover:text-green-700 underline" onclick="toggleDetalle('${idDetalle}')">
                Ver detalles ⯆
              </button>
            </td>
          `;
          tabla.appendChild(row);

          // Fila de detalles (por defecto oculta)
          const filaDetalles = document.createElement('tr');
          filaDetalles.id = idDetalle;
          filaDetalles.classList.add('hidden');
          filaDetalles.innerHTML = `
            <td colspan="4" class="px-6 py-4 text-gray-500">
              <p>${item.detalles}</p>
            </td>
          `;
          tabla.appendChild(filaDetalles);
        });
      }

      // Acción de filtrar
      document.getElementById('btn-filtrar').addEventListener('click', function () {
        // Aquí podrías agregar lógica para filtrar los datos según las fechas seleccionadas
        alert('Filtrar no implementado aún');
      });

      // Acción de ver más
      document.getElementById('btn-ver-mas').addEventListener('click', function () {
        paginaActual++;
        mostrarHistorial();
      });

      // Función para mostrar u ocultar los detalles
      window.toggleDetalle = function(id) {
        const fila = document.getElementById(id);
        const boton = document.getElementById('btn-' + id);

        if (fila.classList.contains('hidden')) {
          fila.classList.remove('hidden');
          boton.innerHTML = 'Ocultar detalles ⯅';
        } else {
          fila.classList.add('hidden');
          boton.innerHTML = 'Ver detalles ⯆';
        }
      };

      // Cargar los primeros datos
      mostrarHistorial();
    });
  </script>
{% endblock %}
