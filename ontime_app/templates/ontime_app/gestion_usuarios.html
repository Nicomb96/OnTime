{% extends 'ontime_app/base.html' %}
{% block content %}

<div class="max-w-6xl mx-auto px-4 py-8 text-black">
  <!-- üß© Tabla de usuarios -->
  <div class="bg-white rounded shadow p-4 overflow-x-auto">
    <h2 class="text-xl font-bold mb-4">Usuarios Registrados</h2>

    <!-- Tabla de usuarios din√°mica -->
    <div id="tabla-usuarios">
      {% include 'ontime_app/partials/tabla_usuarios.html' with usuarios=usuarios %}
    </div>

    <!-- üîç Filtros debajo de la tabla -->
    <form method="GET" class="flex flex-wrap items-center gap-4 mt-6">
      <input type="text" name="q" placeholder="Buscar por nombre" value="{{ nombre }}" class="border px-4 py-2 rounded-md text-black" />

      <select name="rol" class="border px-4 py-2 rounded-md text-black">
        <option value="">Todos los roles</option>
        <option value="Aprendiz" {% if rol == "Aprendiz" %}selected{% endif %}>Aprendiz</option>
        <option value="Instructor" {% if rol == "Instructor" %}selected{% endif %}>Instructor</option>
        <option value="Administrador" {% if rol == "Administrador" %}selected{% endif %}>Administrador</option>
      </select>

      <select name="estado" class="border px-4 py-2 rounded-md text-black">
        <option value="">Todos los estados</option>
        <option value="Activo" {% if estado == "Activo" %}selected{% endif %}>Activo</option>
        <option value="Inactivo" {% if estado == "Inactivo" %}selected{% endif %}>Inactivo</option>
      </select>

      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
        Buscar
      </button>
    </form>

    <!-- Botones de acci√≥n -->
    <div class="flex justify-between mt-6">
      <a href="{% url 'crear_usuario' %}" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
        ‚ûï Nuevo Usuario
      </a>
      <a href="{% url 'exportar_usuarios_excel' %}" class="bg-emerald-700 text-white px-4 py-2 rounded hover:bg-emerald-800">
        üìÅ Exportar a Excel
      </a>
    </div>

    <!-- üîô Bot√≥n de regresar -->
    <div class="mt-6 text-center">
      <a href="{% url 'inicio_admin' %}" class="inline-block bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700 transition">
        ‚¨Ö Volver al Panel de Administraci√≥n
      </a>
    </div>
  </div>
</div>

<!-- ‚úÖ Script √∫nico y limpio para filtros en tiempo real -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const nombreInput = document.querySelector("input[name='q']");
  const rolSelect = document.querySelector("select[name='rol']");
  const estadoSelect = document.querySelector("select[name='estado']");
  const tablaUsuarios = document.getElementById("tabla-usuarios");

  function filtrarUsuarios() {
    const nombre = nombreInput.value;
    const rol = rolSelect.value;
    const estado = estadoSelect.value;

    const params = new URLSearchParams({
      q: nombre,
      rol: rol,
      estado: estado,
    });

    fetch(`/gestion_usuarios/?${params.toString()}`)
      .then(response => response.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");
        const nuevaTabla = doc.querySelector("#tabla-usuarios");
        tablaUsuarios.innerHTML = nuevaTabla.innerHTML;
      });
  }

  nombreInput.addEventListener("input", filtrarUsuarios);
  rolSelect.addEventListener("change", filtrarUsuarios);
  estadoSelect.addEventListener("change", filtrarUsuarios);
});

</script>




{% endblock %}
