{% extends 'ontime_app/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Registrar Cuenta - OnTime{% endblock %}

{% block content %}
  <div class="mt-6 text-center">
    <a href="javascript:history.back()" class="flex items-center text-gray-600 hover:text-green-800 transition-all duration-300">
      <i class="fas fa-arrow-left mr-2"></i>
      Regresar
    </a>
  </div>

  <div class="bg-gray-100 shadow-xl rounded-3xl p-10 w-full max-w-lg mx-auto mt-18 animate__animated animate__fadeIn animate__faster">
    <h2 class="text-4xl font-extrabold text-gray-800 animate-pulse text-center mb-6">Crear Cuenta</h2>
    <p class="text-center text-gray-600 mb-8">¡Bienvenido! Completa los campos para crear tu cuenta.</p>

    {% if messages %}
      <ul class="mb-4">
        {% for message in messages %}
          <li class="text-sm text-{{ message.tags }}-600">{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    <form method="POST" onsubmit="return validarFormulario()">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="text-red-600 text-sm mb-4">
          {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Username -->
      <div class="mb-6">
        <label for="username" class="block text-sm font-medium text-gray-800 mb-1">Usuario</label>
        <input type="text" id="username" name="username" value="{{ form.data.username|default:'' }}" required placeholder="Nombre de usuario"
          class="mt-1 block w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 text-gray-800">
      </div>

      <!-- Nombre -->
      <div class="mb-6">
        <label for="nombre" class="block text-sm font-medium text-gray-800 mb-1">Nombre</label>
        <input type="text" id="nombre" name="nombre" value="{{ form.data.nombre|default:'' }}" required placeholder="Tu nombre"
          class="mt-1 block w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 text-gray-800">
      </div>

      <!-- Apellido -->
      <div class="mb-6">
        <label for="apellido" class="block text-sm font-medium text-gray-800 mb-1">Apellido</label>
        <input type="text" id="apellido" name="apellido" value="{{ form.data.apellido|default:'' }}" required placeholder="Tu apellido"
          class="mt-1 block w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 text-gray-800">
      </div>

      <!-- Correo -->
      <div class="mb-6">
        <label for="correo" class="block text-sm font-medium text-gray-800 mb-1">Correo Electrónico</label>
        <input type="email" id="correo" name="correo" value="{{ form.data.correo|default:'' }}" required placeholder="Ingresa tu correo electrónico"
          class="mt-1 block w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 text-gray-800">
        <p id="errorCorreo" class="text-red-600 text-sm mt-1 hidden">Ingresa un correo válido.</p>
      </div>

      <!-- Contraseña -->
      <div class="mb-6 relative">
        <label for="password1" class="block text-sm font-medium text-gray-800 mb-1">Contraseña</label>
        <div class="relative">
          <input type="password" id="password1" name="password1" required placeholder="Contraseña"
            class="mt-1 block w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 pr-12 transition-all duration-300 text-gray-800"
            oninput="validarContrasena()">
          <div class="absolute inset-y-0 right-3 flex items-center cursor-pointer" onclick="togglePassword()">
            <svg id="iconoOjo" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path id="iconoLinea1" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path id="iconoLinea2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
          </div>
        </div>
        <p id="errorContrasena" class="text-red-600 text-sm mt-1 hidden">La contraseña debe tener al menos 8 caracteres.</p>
      </div>

      <!-- Confirmar Contraseña -->
      <div class="mb-6 relative">
        <label for="password2" class="block text-sm font-medium text-gray-800 mb-1">Confirmar Contraseña</label>
        <div class="relative">
          <input type="password" id="password2" name="password2" required placeholder="Confirmar Contraseña"
            class="mt-1 block w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 pr-12 transition-all duration-300 text-gray-800"
            oninput="validarConfirmarContrasena()">
          <div class="absolute inset-y-0 right-3 flex items-center cursor-pointer" onclick="toggleConfirmPassword()">
            <svg id="iconoOjoConfirmar" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
          </div>
        </div>
        <p id="errorConfirmarContrasena" class="text-red-600 text-sm mt-1 hidden">Las contraseñas no coinciden.</p>
      </div>

      <!-- Rol -->
      <div class="mb-6">
        <label for="rol" class="block text-sm font-medium text-gray-800 mb-1">Rol</label>
        <select id="rol" name="rol" required
          class="mt-1 block w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-300 text-gray-800">
          <option value="" disabled selected>Selecciona tu rol</option>
          <option value="aprendiz" {% if form.data.rol == "aprendiz" %}selected{% endif %}>Aprendiz</option>
          <option value="instructor" {% if form.data.rol == "instructor" %}selected{% endif %}>Instructor</option>
          <option value="admin" {% if form.data.rol == "admin" %}selected{% endif %}>Administrador</option>
        </select>
        <p id="errorRol" class="text-red-600 text-sm mt-1 hidden">Debes seleccionar un rol.</p>
      </div>

      <button type="submit"
        class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-300 shadow-md focus:ring-4 focus:ring-green-500 focus:outline-none">
        Crear cuenta
      </button>

      <div class="flex justify-between items-center text-sm mt-6">
        <a href="{% url 'iniciar_sesion' %}" class="text-green-600 underline">¿Ya tienes cuenta? Inicia sesión</a>
      </div>
    </form>
  </div>

  <script>
    // Funciones JS sin cambios
  </script>
{% endblock %}
